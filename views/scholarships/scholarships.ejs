<%- layout("layouts/boilerplate.ejs") %>

<main>
  <div class="section1">
    <!-- AI Recommendation Badge -->
    <% if (typeof isRecommendedView !== 'undefined' && isRecommendedView === true) { %>
    <div class="container mb-4">
      <div class="alert alert-success border-0 shadow-sm" role="alert">
        <div class="d-flex align-items-center">
          <i class="bi bi-robot fs-3 me-3"></i>
          <div>
            <h5 class="alert-heading mb-1">
              <i class="bi bi-star-fill text-warning"></i> AI Recommended for You
            </h5>
            <p class="mb-0">
              These scholarships are personalized based on your profile:
              <% if (typeof userProfile !== 'undefined' && userProfile) { %>
                <strong>Education:</strong> <%= userProfile.educationLevel %> | 
                <strong>Category:</strong> <%= userProfile.casteCategory %> | 
                <strong>State:</strong> <%= userProfile.state %>
                <% if (userProfile.gender && userProfile.gender !== 'Not specified') { %>
                  | <strong>Gender:</strong> <%= userProfile.gender %>
                <% } %>
              <% } %>
            </p>
          </div>
        </div>
      </div>
    </div>
    <% } %>
    
    <div class="trending-layout">
      <!-- FILTER PANEL -->
      <div class="filter-panel">
        <h4>Filter</h4>
        
        <!-- AI Recommendation Link for Logged-in Users -->
        <% if (typeof currentUser !== 'undefined' && currentUser) { %>
        <div class="ai-button-container">
          <% if (typeof isRecommendedView !== 'undefined' && isRecommendedView === true) { %>
            <a href="/scholarships" class="ai-btn ai-btn-secondary position-relative">
              <i class="bi bi-grid-3x3-gap"></i>
              <span>View All</span>
            </a>
          <% } else { %>
            <a href="/scholarships/recommended" class="ai-btn ai-btn-primary position-relative overflow-hidden">
              <i class="bi bi-robot"></i>
              <span>AI Recommendations</span>
              <i class="bi bi-stars"></i>
            </a>
          <% } %>
        </div>
        <hr>
        <% } %>
        
        <form action="/scholarships" method="GET" id="filterForm">
          <!-- Hidden input to preserve search keyword from navbar -->
          <input type="hidden" name="keyword" value="<%= filters.keyword || '' %>" />

          <div class="filter-group">
            <label>Class / Education Level</label>
            <select name="classLevel">
              <option value="">All</option>
              <option value="Class 1" <%= filters.classLevel === 'Class 1' ? 'selected' : '' %>>Class 1</option>
              <option value="Class 2" <%= filters.classLevel === 'Class 2' ? 'selected' : '' %>>Class 2</option>
              <option value="Class 3" <%= filters.classLevel === 'Class 3' ? 'selected' : '' %>>Class 3</option>
              <option value="Class 4" <%= filters.classLevel === 'Class 4' ? 'selected' : '' %>>Class 4</option>
              <option value="Class 5" <%= filters.classLevel === 'Class 5' ? 'selected' : '' %>>Class 5</option>
              <option value="Class 6" <%= filters.classLevel === 'Class 6' ? 'selected' : '' %>>Class 6</option>
              <option value="Class 7" <%= filters.classLevel === 'Class 7' ? 'selected' : '' %>>Class 7</option>
              <option value="Class 8" <%= filters.classLevel === 'Class 8' ? 'selected' : '' %>>Class 8</option>
              <option value="Class 9" <%= filters.classLevel === 'Class 9' ? 'selected' : '' %>>Class 9</option>
              <option value="Class 10" <%= filters.classLevel === 'Class 10' ? 'selected' : '' %>>Class 10</option>
              <option value="Class 11" <%= filters.classLevel === 'Class 11' ? 'selected' : '' %>>Class 11</option>
              <option value="Class 12" <%= filters.classLevel === 'Class 12' ? 'selected' : '' %>>Class 12</option>
              <option value="Diploma" <%= filters.classLevel === 'Diploma' ? 'selected' : '' %>>Diploma</option>
              <option value="Graduation" <%= filters.classLevel === 'Graduation' ? 'selected' : '' %>>Graduation</option>
              <option value="Post Graduation" <%= filters.classLevel === 'Post Graduation' ? 'selected' : '' %>>Post Graduation</option>
            </select>
          </div>

          <div class="filter-group">
            <label>Gender</label>
            <select name="gender">
              <option value="">All</option>
              <option value="Female" <%= filters.gender === 'Female' ? 'selected' : '' %>>Female</option>
              <option value="Both" <%= filters.gender === 'Both' ? 'selected' : '' %>>General</option>
            </select>
          </div>

          <div class="filter-group">
            <label>Type</label>
            <select name="type">
              <option value="">All</option>
              <option value="Government" <%= filters.type === 'Government' ? 'selected' : '' %>>Government</option>
              <option value="Private" <%= filters.type === 'Private' ? 'selected' : '' %>>Private</option>
              <option value="Other" <%= filters.type === 'Other' ? 'selected' : '' %>>Other</option>
            </select>
          </div>

          <div class="filter-group">
            <label>State</label>
            <select name="state">
              <option value="">All</option>
              <!-- INDIA STATES -->
              <option value="Andhra Pradesh" <%= filters.state === 'Andhra Pradesh' ? 'selected' : '' %>>Andhra Pradesh</option>
              <option value="Arunachal Pradesh" <%= filters.state === 'Arunachal Pradesh' ? 'selected' : '' %>>Arunachal Pradesh</option>
              <option value="Assam" <%= filters.state === 'Assam' ? 'selected' : '' %>>Assam</option>
              <option value="Bihar" <%= filters.state === 'Bihar' ? 'selected' : '' %>>Bihar</option>
              <option value="Chhattisgarh" <%= filters.state === 'Chhattisgarh' ? 'selected' : '' %>>Chhattisgarh</option>
              <option value="Goa" <%= filters.state === 'Goa' ? 'selected' : '' %>>Goa</option>
              <option value="Gujarat" <%= filters.state === 'Gujarat' ? 'selected' : '' %>>Gujarat</option>
              <option value="Haryana" <%= filters.state === 'Haryana' ? 'selected' : '' %>>Haryana</option>
              <option value="Himachal Pradesh" <%= filters.state === 'Himachal Pradesh' ? 'selected' : '' %>>Himachal Pradesh</option>
              <option value="Jharkhand" <%= filters.state === 'Jharkhand' ? 'selected' : '' %>>Jharkhand</option>
              <option value="Karnataka" <%= filters.state === 'Karnataka' ? 'selected' : '' %>>Karnataka</option>
              <option value="Kerala" <%= filters.state === 'Kerala' ? 'selected' : '' %>>Kerala</option>
              <option value="Madhya Pradesh" <%= filters.state === 'Madhya Pradesh' ? 'selected' : '' %>>Madhya Pradesh</option>
              <option value="Maharashtra" <%= filters.state === 'Maharashtra' ? 'selected' : '' %>>Maharashtra</option>
              <option value="Manipur" <%= filters.state === 'Manipur' ? 'selected' : '' %>>Manipur</option>
              <option value="Meghalaya" <%= filters.state === 'Meghalaya' ? 'selected' : '' %>>Meghalaya</option>
              <option value="Mizoram" <%= filters.state === 'Mizoram' ? 'selected' : '' %>>Mizoram</option>
              <option value="Nagaland" <%= filters.state === 'Nagaland' ? 'selected' : '' %>>Nagaland</option>
              <option value="Odisha" <%= filters.state === 'Odisha' ? 'selected' : '' %>>Odisha</option>
              <option value="Punjab" <%= filters.state === 'Punjab' ? 'selected' : '' %>>Punjab</option>
              <option value="Rajasthan" <%= filters.state === 'Rajasthan' ? 'selected' : '' %>>Rajasthan</option>
              <option value="Sikkim" <%= filters.state === 'Sikkim' ? 'selected' : '' %>>Sikkim</option>
              <option value="Tamil Nadu" <%= filters.state === 'Tamil Nadu' ? 'selected' : '' %>>Tamil Nadu</option>
              <option value="Telangana" <%= filters.state === 'Telangana' ? 'selected' : '' %>>Telangana</option>
              <option value="Tripura" <%= filters.state === 'Tripura' ? 'selected' : '' %>>Tripura</option>
              <option value="Uttar Pradesh" <%= filters.state === 'Uttar Pradesh' ? 'selected' : '' %>>Uttar Pradesh</option>
              <option value="Uttarakhand" <%= filters.state === 'Uttarakhand' ? 'selected' : '' %>>Uttarakhand</option>
              <option value="West Bengal" <%= filters.state === 'West Bengal' ? 'selected' : '' %>>West Bengal</option>

              <!-- UNION TERRITORIES -->
              <option value="Chandigarh" <%= filters.state === 'Chandigarh' ? 'selected' : '' %>>Chandigarh</option>
              <option value="Delhi" <%= filters.state === 'Delhi' ? 'selected' : '' %>>Delhi</option>
              <option value="Jammu and Kashmir" <%= filters.state === 'Jammu and Kashmir' ? 'selected' : '' %>>Jammu and Kashmir</option>
              <option value="Ladakh" <%= filters.state === 'Ladakh' ? 'selected' : '' %>>Ladakh</option>
              <option value="Lakshadweep" <%= filters.state === 'Lakshadweep' ? 'selected' : '' %>>Lakshadweep</option>
              <option value="Puducherry" <%= filters.state === 'Puducherry' ? 'selected' : '' %>>Puducherry</option>
            </select>
          </div>
          
          <div class="filter-group">
            <label>Category</label>
            <select name="category">
              <option value="">All</option>
              <option value="General" <%= filters.category === 'General' ? 'selected' : '' %>>General</option>
              <option value="Open" <%= filters.category === 'Open' ? 'selected' : '' %>>Open</option>
              <option value="EWS" <%= filters.category === 'EWS' ? 'selected' : '' %>>EWS</option>
              <option value="OBC" <%= filters.category === 'OBC' ? 'selected' : '' %>>OBC</option>
              <option value="OBC-NCL" <%= filters.category === 'OBC-NCL' ? 'selected' : '' %>>OBC - Non Creamy Layer</option>
              <option value="OBC-CL" <%= filters.category === 'OBC-CL' ? 'selected' : '' %>>OBC - Creamy Layer</option>
              <option value="SEBC" <%= filters.category === 'SEBC' ? 'selected' : '' %>>SEBC</option>
              <option value="SC" <%= filters.category === 'SC' ? 'selected' : '' %>>SC</option>
              <option value="ST" <%= filters.category === 'ST' ? 'selected' : '' %>>ST</option>
              <option value="VJNT" <%= filters.category === 'VJNT' ? 'selected' : '' %>>VJNT</option>
              <option value="NT-A" <%= filters.category === 'NT-A' ? 'selected' : '' %>>NT-A</option>
              <option value="NT-B" <%= filters.category === 'NT-B' ? 'selected' : '' %>>NT-B</option>
              <option value="NT-C" <%= filters.category === 'NT-C' ? 'selected' : '' %>>NT-C</option>
              <option value="NT-D" <%= filters.category === 'NT-D' ? 'selected' : '' %>>NT-D</option>
              <option value="SBC" <%= filters.category === 'SBC' ? 'selected' : '' %>>SBC</option>
              <option value="Minority" <%= filters.category === 'Minority' ? 'selected' : '' %>>Minority</option>
              <option value="Other" <%= filters.category === 'Other' ? 'selected' : '' %>>Other</option>
              <option value="All" <%= filters.category === 'All' ? 'selected' : '' %>>All</option>
            </select>
          </div>
          
          <div class="filter-group">
            <label>Course Category</label>
            <select name="courseCategory">
              <option value="">All</option>
              <option value="Engineering" <%= filters.courseCategory === 'Engineering' ? 'selected' : '' %>>Engineering</option>
              <option value="Medical" <%= filters.courseCategory === 'Medical' ? 'selected' : '' %>>Medical</option>
              <option value="Arts" <%= filters.courseCategory === 'Arts' ? 'selected' : '' %>>Arts</option>
              <option value="Commerce" <%= filters.courseCategory === 'Commerce' ? 'selected' : '' %>>Commerce</option>
              <option value="Science" <%= filters.courseCategory === 'Science' ? 'selected' : '' %>>Science</option>
              <option value="Law" <%= filters.courseCategory === 'Law' ? 'selected' : '' %>>Law</option>
              <option value="Management" <%= filters.courseCategory === 'Management' ? 'selected' : '' %>>Management</option>
              <option value="IT" <%= filters.courseCategory === 'IT' ? 'selected' : '' %>>IT</option>
              <option value="Agriculture" <%= filters.courseCategory === 'Agriculture' ? 'selected' : '' %>>Agriculture</option>
            </select>
          </div>
          
          <button type="submit" class="apply-filter-btn">Apply Filters</button>
          <button type="button" class="apply-filter-btn" onclick="window.location.href='/scholarships'" style="background: #6c757d; margin-top: 10px;">Clear Filters</button>
        </form>
      </div>

      <!-- CARD GRID -->
      <div class="section1-content">
        <!-- Add popup window for scholarship details -->
        <div id="popupOverlay" class="overlay"></div>

        <!-- Popup Box -->
        <div id="popupBox" class="popup">
          <button id="closePopup" class="close-btn">&times;</button>
          <h2 id="popupTitle">Scholarship Details</h2>
          <div class="popup-content">
            <div class="popup-detail">
              <strong>Type:</strong> <span id="popupType"></span>
            </div>
            <div class="popup-detail">
              <strong>Amount:</strong> <span id="popupAmount"></span>
            </div>
            <div class="popup-detail">
              <strong>Deadline:</strong> <span id="popupDeadline"></span>
            </div>
            <div class="popup-detail">
              <strong>Region:</strong> <span id="popupRegion"></span>
            </div>
            <div class="popup-detail">
              <strong>About:</strong>
              <p id="popupAbout"></p>
            </div>
            <div class="popup-detail">
              <strong>Eligibility:</strong>
              <p id="popupEligibility"></p>
            </div>
            <div class="popup-detail">
              <strong>Benefits:</strong>
              <p id="popupBenefits"></p>
            </div>
             <div class="popup-detail">
               <strong>Education:</strong> <span id="popupEducation"></span>
            </div>
            <div class="popup-detail">
              <strong>Required Documents:</strong>
              <p id="popupDocuments"></p>
            </div>
            <div class="popup-detail">
              <strong>Gender:</strong> <span id="popupGender"></span>
            </div>
            <div class="popup-detail">
              <strong>Category:</strong> <span id="popupCategory"></span>
            </div>
            <div class="popup-detail">
              <strong>Course Category:</strong> <span id="popupCourseCategory"></span>
            </div>
            <div class="popup-detail">
              <strong>State:</strong> <span id="popupState"></span>
            </div>
               <div class="popup-detail">
              <strong>Note:</strong>
              <p id="popupNote"></p>
            </div>
          </div>
          <div class="popup-buttons">
            <button id="confirmApply" class="btn-confirm">Apply Now</button>
            <button id="cancelApply" class="btn-cancel">Cancel</button>
          </div>
        </div>

        <div class="section1-grid">
          <!-- CARD -->

          <% if (scholarships && scholarships.length > 0) { %>
            <% for(let scholarship of scholarships) { %>
            <div class="section1-card" data-scholarship-id="<%= scholarship._id %>">
              <div class="section1-article1">
                <div class="info1"><%= scholarship.type %></div>
                <div class="info2">
                  <% if (currentUser) { %>
                    <% const isBookmarked = savedScholarshipIds && savedScholarshipIds.includes(scholarship._id.toString()); %>
                    <button class="bookmark-btn <%= isBookmarked ? 'bookmarked' : '' %>" data-scholarship-id="<%= scholarship._id %>" title="<%= isBookmarked ? 'Remove from saved' : 'Save scholarship' %>">
                      <i class="<%= isBookmarked ? 'fa-solid' : 'fa-regular' %> fa-bookmark"></i>
                    </button>
                  <% } %>
                  <i class="fa-solid fa-arrow-trend-up"></i><span>Trending</span>
                </div>
              </div>
              <div class="section1-article2">
                <h5><%= scholarship.title %></h5>
                <p class="i1">
                  <i class="fa-solid fa-indian-rupee-sign"></i> Amount : <%=
                  scholarship.Amount.toLocaleString() %>
                </p>
                <p class="i1">
                  <i class="fa-regular fa-calendar"></i> Deadline : <%=
                  scholarship.Deadline.toLocaleDateString("en-GB") %>
                </p>
                <p class="i1">
                  Eligibility : <%= scholarship.Eligibility.substring(0, 50) %>...
                </p>
              </div>
              <div class="section3-article3">
                <button
                  style="width: 100%"
                  class="apply-now-btn"
                  data-link="<%= scholarship.ApplyLink %>"
                  data-title="<%= scholarship.title %>"
                  data-type="<%= scholarship.type %>"
                  data-amount="<%= scholarship.Amount.toLocaleString() %>"
                  data-about="<%= scholarship.About %>"
                  data-eligibility="<%= scholarship.Eligibility %>"
                  data-deadline="<%= scholarship.Deadline.toLocaleDateString('en-GB') %>"
                  data-benefits="<%= scholarship.Benefits %>"
                  data-region="<%= scholarship.Region %>"
                  data-education="<%= scholarship.Education %>"
                  data-documents="<%= scholarship.Documents %>"
                  data-Gender="<%= scholarship.Gender %>"
                  data-Category="<%= scholarship.Category %>"
                  data-CourseCategory="<%= scholarship.CourseCategory %>"
                  data-State="<%= scholarship.State %>"
                  data-note="<%= scholarship.Note %>"
                >
                  Apply Now
                </button>
              </div>
            </div>
            <% } %>
          <% } else { %>
            <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px;">
              <i class="bi bi-search" style="font-size: 3rem; color: #ccc; margin-bottom: 20px; display: block;"></i>
              <h3 style="color: #666; margin: 20px 0; font-weight: 600;">No Scholarships Found</h3>
              <p style="color: #999; margin-bottom: 30px; font-size: 1rem;">
                We couldn't find any scholarships matching your filters. Try adjusting your search criteria.
              </p>
              <a href="/scholarships" style="display: inline-block; padding: 12px 32px; background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 50%, #ec4899 100%); color: #f8fafc; text-decoration: none; border-radius: 14px; font-weight: 700; font-size: 1rem; letter-spacing: 0.35px; box-shadow: 0 14px 32px rgba(124, 58, 237, 0.32); transition: transform 0.22s ease, box-shadow 0.22s ease, filter 0.22s ease; border: 1px solid rgba(255, 255, 255, 0.2);" onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 18px 40px rgba(124, 58, 237, 0.38)'; this.style.filter='brightness(1.05)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 14px 32px rgba(124, 58, 237, 0.32)'; this.style.filter='brightness(1)';">Clear Filters</a>
            </div>
          <% } %>

          <!-- add card from here -->
        </div>
      </div>
    </div>
  </div>
</main>
